<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>极简自动售货机</title>
    <style>
        body {
            font-family: sans-serif;
            max-width: 600px;
            margin: 20px auto;
            padding: 0 10px;
        }
        .machine {
            border: 2px solid #333;
            padding: 15px;
            background: #f9f9f9;
        }
        .products {
            margin: 15px 0;
            padding: 10px;
            border: 1px solid #ccc;
        }
        .product-item {
            margin: 5px 0;
        }
        .panel {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ccc;
        }
        button {
            padding: 5px 10px;
            margin: 3px;
            cursor: pointer;
        }
        #message {
            margin: 10px 0;
            padding: 8px;
            min-height: 20px;
        }
        .success {
            background: #dff0d8;
            border: 1px solid #3c763d;
        }
        .error {
            background: #f2dede;
            border: 1px solid #a94442;
        }
    </style>
</head>
<body>
    <div class="machine">
        <h2>自动售货机</h2>

        <!-- 商品列表 -->
        <div class="products">
            <h3>商品列表</h3>
            <div id="productList">
                <!-- 商品将动态生成 -->
            </div>
        </div>

        <!-- 投币区 -->
        <div class="panel">
            <h3>投币</h3>
            <button class="coin" data-val="1">1元</button>
            <button class="coin" data-val="5">5元</button>
            <button class="coin" data-val="10">10元</button>
            <p>当前余额: <span id="balance">0</span>元</p>
        </div>

        <!-- 操作区 -->
        <div class="panel">
            <h3>购买</h3>
            <input type="number" id="pid" placeholder="输入商品编号" min="1">
            <button id="buy">购买</button>
            <button id="refund">退币</button>

            <div id="message" class="success">请投币后购买商品</div>

            <div>
                <h4>出货口</h4>
                <div id="output" style="border:1px solid #ccc; padding:5px; min-height:20px;">空</div>
            </div>
        </div>
    </div>

    <script>
        const products = [
            { id: 1, name: '可乐', price: 3, stock: 5 },
            { id: 2, name: '雪碧', price: 3, stock: 4 },
            { id: 3, name: '矿泉水', price: 2, stock: 10 },
            { id: 4, name: '巧克力', price: 5, stock: 3 }
        ];

        let balance = 0;

        const productListEl = document.getElementById('productList');
        const balanceEl = document.getElementById('balance');
        const pidEl = document.getElementById('pid');
        const buyBtn = document.getElementById('buy');
        const refundBtn = document.getElementById('refund');
        const messageEl = document.getElementById('message');
        const outputEl = document.getElementById('output');

        function renderProducts() {
            productListEl.innerHTML = '';
            products.forEach(p => {
                const el = document.createElement('div');
                el.className = 'product-item';
                el.textContent = `[${p.id}] ${p.name} - ${p.price}元 (库存: ${p.stock})`;
                productListEl.appendChild(el);
            });
        }

        function showMessage(text, isError = false) {
            messageEl.textContent = text;
            messageEl.className = isError ? 'error' : 'success';
        }

        document.querySelectorAll('.coin').forEach(btn => {
            btn.addEventListener('click', () => {
                const val = parseInt(btn.dataset.val);
                balance += val;
                balanceEl.textContent = balance;
                showMessage(`已投入${val}元`);
            });
        });

        buyBtn.addEventListener('click', () => {
            const pid = parseInt(pidEl.value);
            if (!pid) {
                showMessage('请输入商品编号', true);
                return;
            }

            const product = products.find(p => p.id === pid);
            if (!product) {
                showMessage('商品不存在', true);
                return;
            }
            if (product.stock <= 0) {
                showMessage('商品已售罄', true);
                return;
            }
            if (balance < product.price) {
                showMessage('余额不足', true);
                return;
            }

            // 完成购买
            product.stock--;
            balance -= product.price;
            balanceEl.textContent = balance;
            outputEl.textContent = `已出货: ${product.name}`;
            showMessage(`购买成功，找零${balance}元`);
            renderProducts();
            pidEl.value = '';
        });

        // 退币事件
        refundBtn.addEventListener('click', () => {
            if (balance > 0) {
                showMessage(`已退币${balance}元`);
                outputEl.textContent = `已退币${balance}元`;
                balance = 0;
                balanceEl.textContent = balance;
            } else {
                showMessage('没有可退的余额', true);
            }
        });

        // 初始化
        renderProducts();
    </script>
</body>
</html>